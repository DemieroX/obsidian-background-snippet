/* @settings

name: Background Settings

id: note-background-image-settings

settings:

- heading: Background Image Adjustments

- id: note-bg-opacity

  title: Opacity

  type: variable-number-slider

  default: 0.25

  min: 0

  max: 1

  step: 0.01

  format:

- id: note-bg-blur

  title: Blur Effect

  type: variable-number-slider

  default: 0

  min: 0

  max: 10

  step: 1

  format: px

- id: note-bg-saturate

  title: Saturation

  type: variable-number-slider

  default: 1

  min: 0

  max: 3

  step: 0.1

  format:

- id: note-bg-blur-mobile

  title: Mobile Blur Effect

  description: Reduces blur on smaller screens to help with performance.

  type: variable-number-slider

  default: 0

  min: 0

  max: 10

  step: 1

  format: px

*/

/* --- Usage Instructions ---

   1. Add 'cssclasses: background' to the note's frontmatter.

   2. Embed an image with the alias "background": ![[my-image.png|background]]

*/


/* 1. Note Container Stacking Context */
.workspace-leaf-content .background .markdown-preview-view,
.workspace-leaf-content .background .markdown-source-view {
  position: relative; 
  z-index: 1; 
  background-color: transparent;
  isolation: isolate;
}


/* 2. Background Image (Lowest Layer: z-index: -1) */
.workspace-leaf-content .background img[alt="background"] {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
  z-index: -1;               
  pointer-events: none;     
  user-select: none;        
  mix-blend-mode: normal; 
  opacity: var(--note-bg-opacity, 0.25);
  filter: blur(var(--note-bg-blur, 0px)) saturate(var(--note-bg-saturate, 1));
}


/* 3. Note Content (Text & Blocks: z-index: 2) */
.workspace-leaf-content .background .markdown-preview-section,
.workspace-leaf-content .background .cm-s-obsidian,
.workspace-leaf-content .background .markdown-preview-view > * {
  position: relative;
  z-index: 2; 
  background: transparent;
}


/* 4. Content Image Fix (Highest Layer: z-index: 1000) */
/* Target the image container wrapper */
.workspace-leaf-content .background .markdown-preview-view .internal-embed.image-embed:not([alt="background"]),
.workspace-leaf-content .background .markdown-source-view .internal-embed.image-embed:not([alt="background"]) {
    position: relative !important;
    z-index: 1000 !important; 
    background-color: var(--background-primary) !important;
    mix-blend-mode: normal !important; 
    -webkit-backface-visibility: hidden;
    -webkit-transform: translateZ(0);
}

/* Target the image element itself */
.workspace-leaf-content .background .markdown-preview-view img:not([alt="background"]),
.workspace-leaf-content .background .markdown-source-view img:not([alt="background"]) {
  position: relative !important;
  z-index: 1000 !important;
  mix-blend-mode: normal !important;
  opacity: 1 !important; 
  background-color: var(--background-primary) !important;
}

/* 5. Mobile Adjustment */
@media (max-width: 600px) {
  .workspace-leaf-content .background img[alt="background"] {
    filter: blur(var(--note-bg-blur-mobile, 0px)) saturate(var(--note-bg-saturate, 1));
  }
}